<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <title>IMPRESSÃO DE ETIQUETAS</title>

    <style>
      #preview {
          width: 300px;
          height: 200px;
          border: 1px solid black;
          position: relative;
          margin-bottom: 20px;
      }
      .label-text {
          position: absolute;
      }
  </style>
</head>
<body>
    
    <div class="header">
        <div class="LOGO1">
            <a href="/html/Menu.html">
                <img src="/img/Usinagem/Sem título.png" alt="Imagem 3D">
            </a>
        </div>
        <h1>IMPRESSÃO DE ETIQUETAS</h1>
        <div class="sidebar-buttons-container">
        </div>
    </div>

    <h1>Designer de Etiquetas ZPL</h1>
    <div id="preview"></div>
    <label for="text">Texto:</label>
    <input type="text" id="text"><br>
    <label for="font-size">Tamanho da Fonte:</label>
    <input type="number" id="font-size" min="8" max="72" value="12"><br>
    <label for="x-position">Posição X:</label>
    <input type="number" id="x-position" min="0" max="300" value="10"><br>
    <label for="y-position">Posição Y:</label>
    <input type="number" id="y-position" min="0" max="200" value="20"><br>
    <label for="rotation">Rotação:</label>
    <select id="rotation">
        <option value="N">Normal</option>
        <option value="R">90 graus no sentido horário</option>
        <option value="I">Invertido (180 graus)</option>
        <option value="B">90 graus no sentido anti-horário</option>
    </select><br>
    <label for="file-name">Nome do Arquivo:</label>
    <input type="text" id="file-name" value="label_template.zpl"><br>
    <button onclick="addTextLabel()">Adicionar Texto</button>
    <button onclick="generateZPL()">Gerar ZPL</button>
    <button onclick="saveZPL()">Salvar Arquivo</button>

    <script>
        var labels = [];

        function addTextLabel() {
            var text = document.getElementById('text').value;
            var fontSize = document.getElementById('font-size').value;
            var xPos = document.getElementById('x-position').value;
            var yPos = document.getElementById('y-position').value;
            var rotation = document.getElementById('rotation').value;

            var label = {
                text: text,
                fontSize: fontSize,
                x: xPos,
                y: yPos,
                rotation: rotation
            };

            labels.push(label);

            var labelElement = document.createElement('div');
            labelElement.className = 'label-text';
            labelElement.textContent = text;
            labelElement.style.fontSize = fontSize + 'px';
            labelElement.style.left = xPos + 'px';
            labelElement.style.top = yPos + 'px';

            switch(rotation) {
                case 'N':
                    labelElement.style.transform = 'rotate(0deg)';
                    break;
                case 'R':
                    labelElement.style.transform = 'rotate(90deg)';
                    break;
                case 'I':
                    labelElement.style.transform = 'rotate(180deg)';
                    break;
                case 'B':
                    labelElement.style.transform = 'rotate(-90deg)';
                    break;
                default:
                    labelElement.style.transform = 'rotate(0deg)';
            }

            document.getElementById('preview').appendChild(labelElement);
        }

        function generateZPL() {
            // Você pode querer verificar se há pelo menos uma etiqueta antes de gerar o ZPL
            if (labels.length === 0) {
                alert('Adicione pelo menos uma etiqueta antes de gerar o ZPL.');
                return;
            }

            // Enviar dados para a API Node.js
            fetch('http://localhost:5500/api/gerar-zpl', {
              method: 'POST', // Certifique-se de que o método é POST
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({ labels: labels })
          })
          .then(response => response.json())
          .then(data => {
              if (data.filePath) {
                  alert('Arquivo ZPL gerado com sucesso! O arquivo está disponível em: ' + data.filePath);
              } else {
                  alert('Erro ao gerar arquivo ZPL.');
              }
          })
          .catch(error => {
              console.error('Erro ao gerar arquivo ZPL:', error);
              alert('Erro ao gerar arquivo ZPL. Verifique o console para mais detalhes.');
          });
          
        }


    </script>

    <div class="linha-separadora1"></div>
    <link rel="stylesheet" href="/css/public.css">
    <script src="/js/SolicitarSetupUsinagem.js"></script>
    <script src="/js/public.js"></script>

</body>
</html>
