<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    
    <title>IPG</title>
</head>
<body>
    
    <div class="header">
        <h1>TABELA IMPREGNA</h1>
        <button class="LOGO0" type="button" onclick="carregarValores()">
            <img src="/img/docol_120.png" alt="Imagem 3D">
        </button> 

        <button class="LOGOLogin" type="button" onclick="carregarValores0()">
            <img id="INFO1" class="imagem" src="" alt="imagem">
        </button> 

        <div class="sidebar-buttons-container">
            <button class="sidebar-button" type="button" onclick="openForm()">Cadastro Impregna</button>
            <button class="sidebar-button" id="viewCardsBtn">Visualizar como Cart√µes</button>
            <button class="sidebar-button" id="viewListBtn">Visualizar como Lista</button>
        </div>
    </div>

    <div class="linha-separadora1"></div>

    <div class="overlay" id="overlay">
        <div class="modal">
            <h2>Solicita√ß√£o de Setup</h2>
            <form id="formNovotabeImpregna">
                <div class="form-group">
                    <label for="documento-compras">Documento de Compras</label>
                    <input type="number" id="documento-compras" name="documento-compras">
                </div>
                
                <div class="form-group">
                    <label for="item">Item</label>
                    <input type="number" id="item" name="item">
                </div>

                <div class="form-group">
                    <label for="fornecedor">Fornecedor</label>
                    <input type="number" id="fornecedor" name="fornecedor">
                </div>

                <div class="form-group">
                    <label for="grupo-mercadorias">Grupo de Mercadorias</label>
                    <input type="text" id="grupo-mercadorias" name="grupo-mercadorias" maxlength="7">
                </div>

                <div class="form-group">
                    <label for="material">Material</label>
                    <input type="number" id="material" name="material">
                </div>

                <div class="form-group">
                    <label for="org-compras">Organiza√ß√£o de Compras</label>
                    <select id="org-compras" name="org-compras"></select>
                </div>

                <div class="form-group">
                    <label for="grp-compradores">Grupo de Compradores</label>
                    <select id="grp-compradores" name="grp-compradores"></select>
                </div>

                <div class="form-group">
                    <label for="centro">Centro</label>
                    <select id="centro" name="centro"></select>
                </div>

                <div class="form-group">
                    <label for="deposito">Dep√≥sito</label>
                    <input type="text" id="deposito" name="deposito">
                </div>

                <div class="form-group">
                    <label for="data-documento">Data do Documento</label>
                    <input type="date" id="data-documento" name="data-documento">
                </div>

                <div class="form-group">
                    <label for="qtd-pedido">Quantidade Pedido</label>
                    <input type="number" id="qtd-pedido" name="qtd-pedido">
                </div>

                <div class="form-group">
                    <label for="um-pedido">UM Pedido</label>
                    <select id="um-pedido" name="um-pedido"></select>
                </div>

                <div class="form-group">
                    <label for="valor-liq-pedido">Valor L√≠quido Pedido</label>
                    <input type="number" id="valor-liq-pedido" name="valor-liq-pedido">
                </div>

                <div class="form-group">
                    <label for="moeda">Moeda</label>
                    <select id="moeda" name="moeda"></select>
                </div>

                <div class="form-group">
                    <label for="unid-prc-pedido">Unidade de Pre√ßo Pedido</label>
                    <select id="unid-prc-pedido" name="unid-prc-pedido"></select>
                </div>

                <div class="form-group">
                    <label for="incompleto">Incompleto</label>
                    <input type="text" id="incompleto" name="incompleto">
                </div>

                <div class="form-group">
                    <label for="tipo-doc-compras">Tipo Documento Compras</label>
                    <select id="tipo-doc-compras" name="tipo-doc-compras"></select>
                </div>

                <div class="form-group">
                    <label for="centro-fornecedor">Centro Fornecedor</label>
                    <input type="text" id="centro-fornecedor" name="centro-fornecedor">
                </div>

                <div class="form-group">
                    <label for="texto-breve">Texto Breve</label>
                    <textarea type="text"  id="texto-breve" name="texto-breve"></textarea><br>
                </div>

                <div class="form-group">
                    <button type="submit">Solicitar</button>
                    <button type="button" onclick="closeForm()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Menu de contexto -->
    <div id="menuContexto" class="menu-contexto">
    <ul>
        <li><a href="#acao1">A√ß√£o 1</a></li>
        <li><a href="#acao2">A√ß√£o 2</a></li>
        <li><a href="#acao3">A√ß√£o 3</a></li>
        <!-- Adicione mais a√ß√µes conforme necess√°rio -->
    </ul>
    </div>

    <div id="pedidosContainer"></div>
    <!-- Restante do seu HTML -->
    <div class="container1">   
        <div class="scroll-wrapper">
            <div id="pedidosContainer" class="card-container">
                <!-- Cart√µes ser√£o adicionados aqui dinamicamente -->
            </div>    
        </div>
    </div>

    <div id="agendamentosContainer1"></div>

    <script>
                
        //-------------------------------------------------------------------------
        const BASE_URL = 'http://localhost:5500';
        //-------------------------------------------------------------------------

        //__________________________________________________________________________________________________________
        //üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö• ACESSOS üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•

        const userAcess = localStorage.getItem('acess');
        const thirdNumber = userAcess.charAt(1);

        if (thirdNumber !== '1') {
            // Usu√°rio n√£o tem o acesso desejado
            alert('Acesso negado.');
            window.location.href = '/html/Menu.html'; // Redireciona ou oculta certos elementos da p√°gina
            // Se o terceiro n√∫mero for 4, o usu√°rio tem acesso e o c√≥digo continua normalmente
        } else {
            // Se userAccess for null ou undefined, trata como n√£o logado ou sem acesso
            // alert('Acesso com Sucesso');
        }
        //__________________________________________________________________________________________________________
        //üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•
        // Seleciona o campo de entrada
        const grpCompradoresInput = document.getElementById('grupo-mercadorias');

        // Adiciona um listener de evento para formatar o valor do campo conforme a m√°scara
        grpCompradoresInput.addEventListener('input', function(event) {
            const value = event.target.value.replace(/\D/g, ''); // Remove todos os caracteres n√£o num√©ricos
            const maskedValue = value.replace(/(\d{3})(\d{3})/, '$1.$2'); // Formata como 002.006

            event.target.value = maskedValue; // Define o valor formatado de volta no campo
        });

        // Fun√ß√£o para carregar um arquivo JSON
function loadJSON(callback) {
    var xobj = new XMLHttpRequest();
    xobj.overrideMimeType("application/json");
    xobj.open('GET', '/json/data.json', true);
    xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
            callback(JSON.parse(xobj.responseText));
        }
    };
    xobj.send(null);
}

// Fun√ß√£o para preencher o campo org-compras com os dados do arquivo JSON
function populateOrgCompras() {
    loadJSON(function(data) {
        const orgComprasSelect = document.getElementById('org-compras');
        const orgComprasSelect1 = document.getElementById('grp-compradores');
        const orgComprasSelect2 = document.getElementById('centro');
        const orgComprasSelect3 = document.getElementById('tipo-doc-compras');
        const orgComprasSelect4 = document.getElementById('moeda');
        const orgComprasSelect5 = document.getElementById('unid-prc-pedido');
        const orgComprasSelect6 = document.getElementById('um-pedido');
        const OrgCompra = data.OrgCompra;
        const GrupCompra = data.GrupCompra;
        const centro = data.centro;
        const UM = data.UM;
        const TipoDoc = data.TipoDoc;
        const Moeda = data.Moeda;

        OrgCompra.forEach(function(OrgCompra) {
            const option = document.createElement('option');
            option.value = OrgCompra;
            option.text = OrgCompra;
            orgComprasSelect.appendChild(option);
        });
        GrupCompra.forEach(function(GrupCompra) {
            const option = document.createElement('option');
            option.value = GrupCompra;
            option.text = GrupCompra;
            orgComprasSelect1.appendChild(option);
        });
        centro.forEach(function(centro) {
            const option = document.createElement('option');
            option.value = centro;
            option.text = centro;
            orgComprasSelect2.appendChild(option);
        });
        TipoDoc.forEach(function(TipoDoc) {
            const option = document.createElement('option');
            option.value = TipoDoc;
            option.text = TipoDoc;
            orgComprasSelect3.appendChild(option);
        });
        Moeda.forEach(function(Moeda) {
            const option = document.createElement('option');
            option.value = Moeda;
            option.text = Moeda;
            orgComprasSelect4.appendChild(option);
        });
        UM.forEach(function(UM) {
            const option = document.createElement('option');
            option.value = UM;
            option.text = UM;
            orgComprasSelect5.appendChild(option);
            orgComprasSelect6.appendChild(option.cloneNode(true));
        });
    });
}

// Chama a fun√ß√£o para preencher o campo org-compras quando a p√°gina carrega
document.addEventListener('DOMContentLoaded', populateOrgCompras);

        //__________________________________________________________________________________________________________
        //üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•üö•
        document.addEventListener('DOMContentLoaded', function () {
            const menuContexto = document.getElementById('menuContexto');
        
            // Fun√ß√£o auxiliar para verificar se o elemento ou um de seus pais corresponde ao seletor
            function matchesSelectorOrParent(element, selector) {
                if (element.matches(selector)) {
                    return true;
                } else if (element.parentElement) {
                    return matchesSelectorOrParent(element.parentElement, selector);
                }
                return false;
            }
        
            document.getElementById('pedidosContainer').addEventListener('contextmenu', function (e) {
                if (matchesSelectorOrParent(e.target, 'tbody tr')) {
                    e.preventDefault(); // Impede o menu de contexto padr√£o
                    menuContexto.style.display = 'block';
                    menuContexto.style.left = e.pageX + 'px'; // Posiciona o menu no local do clique
                    menuContexto.style.top = e.pageY + 'px';
                }
            });
        
            // Esconde o menu ao clicar em qualquer lugar na p√°gina
            document.addEventListener('click', function (e) {
                menuContexto.style.display = 'none';
            });
        });
        
        function renderizarComoLista(data) {
            const pedidosContainer = document.getElementById('pedidosContainer');
            pedidosContainer.innerHTML = ''; // Limpa o cont√™iner
        
            let ordenacaoAtual = { coluna: 'Id', ascendente: true };
        
            // Fun√ß√£o para criar √≠cones de ordena√ß√£o
            function criarIconeOrdenacao(ascendente) {
                return ascendente ? '‚Üë' : '‚Üì';
            }
        
            // Fun√ß√£o para atualizar a tabela com os dados ordenados
            function atualizarTabela(propriedade) {
                const coluna = {
                    'Id': 'Id',
                    'login': 'login',
                    'Documento_compras': 'Documento_compras',
                    'item': 'item',
                    'Fornecedor': 'Fornecedor',
                    'Grupo_mercadorias': 'Grupo_mercadorias',
                    'Material': 'Material',
                    'Org_compras': 'Org_compras',
                    'Grp_compradores': 'Grp_compradores',
                    'Centro': 'Centro',
                    'Deposito': 'Deposito',
                    'Data_documento': 'Data_documento',
                    'Qtd_pedido': 'Qtd_pedido',
                    'UM_pedido': 'UM_pedido',
                    'Valor_l√≠q_pedido': 'Valor_l√≠q_pedido',
                    'Moeda': 'Moeda',
                    'Unid_prc_pedido': 'Unid_prc_pedido',
                    'Incompleto': 'Incompleto',
                    'Tipo_doc_compras': 'Tipo_doc_compras',
                    'Centro_fornecedor': 'Centro_fornecedor',
                    'Texto_breve': 'Texto_breve',
                    'obs': 'obs',
                    // Adicione mapeamentos adicionais conforme necess√°rio
                }[propriedade] || propriedade;
        
                if (ordenacaoAtual.coluna === coluna) {
                    ordenacaoAtual.ascendente = !ordenacaoAtual.ascendente; // Inverte a dire√ß√£o
                } else {
                    ordenacaoAtual = { coluna: coluna, ascendente: true }; // Reinicia a dire√ß√£o quando uma nova coluna √© selecionada
                }
        
                // Atualiza o corpo da tabela
                tbody.innerHTML = '';
                data.forEach(solicitacao => {
                    const row = document.createElement('tr');
                    row.className = `status${solicitacao.status ? solicitacao.status.toLowerCase() : ''}`;
;
                    row.innerHTML = `<td>${solicitacao.Id}</td>
                                    <td>${solicitacao.Documento_compras}</td>
                                    <td>${solicitacao.item}</td>
                                    <td>${solicitacao.Fornecedor}</td>
                                    <td>${solicitacao.Grupo_mercadorias}</td>
                                    <td>${solicitacao.Material}</td>
                                    <td>${solicitacao.Org_compras}</td>
                                    <td>${solicitacao.Grp_compradores}</td>
                                    <td>${solicitacao.Centro}</td>
                                    <td>${solicitacao.Deposito}</td>
                                    <td>${solicitacao.Data_documento}</td>
                                    <td>${solicitacao.Qtd_pedido}</td>
                                    <td>${solicitacao.UM_pedido}</td>
                                    <td>${solicitacao.Valor_l√≠q_pedido}</td>
                                    <td>${solicitacao.Moeda}</td>
                                    <td>${solicitacao.Unid_prc_pedido}</td>
                                    <td>${solicitacao.Incompleto}</td>
                                    <td>${solicitacao.Tipo_doc_compras}</td>
                                    <td>${solicitacao.Centro_fornecedor}</td>
                                    <td>${solicitacao.Texto_breve}</td>
                                    <td>${solicitacao.obs}</td>`;
                        tbody.appendChild(row);
                    });
            
                    // Atualiza os √≠cones de ordena√ß√£o nos cabe√ßalhos
                    document.querySelectorAll('th').forEach(header => {
                        const propriedadeHeader = header.getAttribute('data-propriedade');
                        if (propriedadeHeader) {
                            header.innerHTML = propriedadeHeader + (coluna === propriedadeHeader ? criarIconeOrdenacao(ordenacaoAtual.ascendente) : '');
                        }
                    });
                }
            
                // Cria a tabela e o cabe√ßalho, incluindo atributos de data-propriedade
                const tabela = document.createElement('table');
                tabela.innerHTML = `<thead>
                                        <tr>
                                            <th data-propriedade="Id">Id</th>
                                            <th data-propriedade="Documento_compras">Documento compras</th>
                                            <th data-propriedade="item">Item</th>
                                            <th data-propriedade="Fornecedor">Fornecedor</th>
                                            <th data-propriedade="Grupo_mercadorias">Grupo mercadorias</th>
                                            <th data-propriedade="Material">Material</th>
                                            <th data-propriedade="Org_compras">Org compras</th>
                                            <th data-propriedade="Grp_compradores">Grp compradores</th>
                                            <th data-propriedade="Centro">Centro</th>
                                            <th data-propriedade="Deposito">Deposito</th>
                                            <th data-propriedade="Data_documento">Data documento</th>
                                            <th data-propriedade="Qtd_pedido">Qtd pedido</th>
                                            <th data-propriedade="UM_pedido">UM pedido</th>
                                            <th data-propriedade="Valor_l√≠q_pedido">Valor l√≠q pedido</th>
                                            <th data-propriedade="Moeda">Moeda</th>
                                            <th data-propriedade="Unid_prc_pedido">Unid prc pedido</th>
                                            <th data-propriedade="Incompleto">Incompleto</th>
                                            <th data-propriedade="Tipo_doc_compras">Tipo doc compras</th>
                                            <th data-propriedade="Centro_fornecedor">Centro fornecedor</th>
                                            <th data-propriedade="Texto_breve">Texto breve</th>
                                            <th data-propriedade="obs">Obs</th>
                                        </tr>
                                    </thead>`;
                const tbody = document.createElement('tbody');
                tabela.appendChild(tbody);
                pedidosContainer.appendChild(tabela);
            
                // Adiciona listeners nos cabe√ßalhos para ordena√ß√£o
                tabela.querySelectorAll('th').forEach(header => {
                    header.addEventListener('click', () => {
                        const propriedade = header.getAttribute('data-propriedade');
                        if (propriedade) atualizarTabela(propriedade.toLowerCase());
                    });
                });
            
                atualizarTabela('HRpedido'); // Ordena inicialmente por 'Id'
            }
        
        function renderizarComoCartoes(data) {
            fetch(`${BASE_URL}/tabeImpregna`)
                .then(response => response.json())
                .then(data => {
                    data.sort((a, b) => {
                        // Converta as horas para objetos Date para que possam ser comparados
                        const horaA = new Date(`1970-01-01T${a.horario}`);
                        const horaB = new Date(`1970-01-01T${b.horario}`);

                        // Compare as horas e retorne o resultado da compara√ß√£o
                        return horaA - horaB;
                    });
                    // Limpe o conte√∫do do cont√™iner antes de adicionar novos elementos
                    const pedidosContainer = document.getElementById('pedidosContainer');
                    pedidosContainer.innerHTML = '';

                    // Itere sobre os dados recebidos e crie um cart√£o para cada solicita√ß√£o
                    data.forEach(solicitacao => {
                        // Cria um novo elemento div para representar o cart√£o
                        const card = document.createElement('div');
                        card.classList.add('card1');

                        // Crie um novo elemento div para representar o conte√∫do do cart√£o
                        const cardContent = document.createElement('div');
                        cardContent.classList.add('card-content');      
                        cardContent.innerHTML = `

                                            <button class="menu-button">Menu</button>
                                            <div class="status-buttons">
                                                <button class="button-cancelado">Cancelado</button>
                                                <button class="button-folha">Folha Processo</button>
                                                <button class="button-fip">FIP</button>
                                                <button class="button-excluir">Excluir</button>
                                            </div>

                                            <form id="formAlterarSetup">
                                                <div class="infoId">
                                                    <div><label class="info-line">${solicitacao.Id}</p></label ></div>
                                                </div>

                                                <div class="info0">

                                                    <div class="linha-separadora"></div> 
                                                    <div><label class="texto1">CentroCusto</label></div>  
                                                    <div><label class="info-line">${solicitacao.cc}</p></label ></div>
                                                    
                                                    <div class="linha-separadora"></div> 
                                                    <div><label class="texto1">M√°quina</label></div>  
                                                    <div><label class="info-line">${solicitacao.maquina}</p></label ></div>

                                                    <div class="linha-separadora"></div>    
                                                    <div><label class="texto1">Item</label></div>  
                                                    <div><label class="info-line item">${solicitacao.item}</p></label ></div>

                                                    <div class="linha-separadora"></div>    
                                                    <div><label class="texto1">Hora</label></div>  
                                                    <div><label class="info-line">${solicitacao.horario}</p></label ></div>
                                                    
                                                    <!-- Adicione a linha abaixo para o elemento de status -->
                                                    <div class="linha-separadora"></div>    
                                                    <div class="objeto-card status"><label class="texto1">Status</label></div>  
                                                    <div class="objeto-card status"><label class="info-line">${solicitacao.status}</p></label></div>

                                                    <div class="linha-separadora"></div>    
                                                    <div><label class="texto1">Operacao</label></div>  
                                                    <div><label class="info-line">${solicitacao.operacao}</p></label></div>

                                                    <div class="linha-separadora"></div>    
                                                    <div><label class="texto1">Lote</label></div>  
                                                    <div><label class="info-line">${solicitacao.lote}</p></label></div>

                                                    <div class="linha-separadora"></div>    
                                                    <div><label class="texto1">Observacao</label></div>  
                                                    <div><label class="info-line1">${solicitacao.obs}</label></div>
                                                </div>
                                        </form>
                                        `;
                                        // Adicione o conte√∫do do cart√£o ao cart√£o
                                        card.appendChild(cardContent);

                                        // Adicione o cart√£o ao cont√™iner de pedidos
                                        pedidosContainer.appendChild(card);

                                        // Aplique a classe de status ao cart√£o
                                        card.classList.add(solicitacao.status.toLowerCase());
                                    });
                                })
        }
        
        function atualizarDados() {
            fetch(`${BASE_URL}/tabeImpregna`)
                .then(response => response.json())
                .then(data => {
                    renderizarComoLista(data); // ou renderizarComoCartoes(data);
                })
                .catch(error => {
                    console.error('Erro ao buscar dados:', error);
                });
        }

        document.getElementById('viewCardsBtn').addEventListener('click', () => {
            fetch(`${BASE_URL}/tabeImpregna`)
                .then(response => response.json())
                .then(data => renderizarComoCartoes(data));
        });
        
        document.getElementById('viewListBtn').addEventListener('click', () => {
            fetch(`${BASE_URL}/tabeImpregna`)
                .then(response => response.json())
                .then(data => renderizarComoLista(data));
        });

// Defina a fun√ß√£o para atualizar os dados

//___________________________________________________________________________________
// Rota para adicionar um novo cliente
//___________________________________________________________________________________
        document.getElementById('formNovotabeImpregna').addEventListener('submit', async function(event) {
            // Evite que o formul√°rio seja enviado automaticamente
            event.preventDefault();

            // Verifique se todos os campos obrigat√≥rios foram preenchidos antes de enviar o formul√°rio
            const login = "Fernando Habeck";
            const documentoCompras = document.getElementById('documento-compras').value;
            const item = document.getElementById('item').value;
            const fornecedor = document.getElementById('fornecedor').value;
            const grupoMercadorias = document.getElementById('grupo-mercadorias').value;
            const material = document.getElementById('material').value;
            const orgCompras = document.getElementById('org-compras').value;
            const grpCompradores = document.getElementById('grp-compradores').value;
            const centro = document.getElementById('centro').value;
            const deposito = document.getElementById('deposito').value;
            const dataDocumento = document.getElementById('data-documento').value;
            const qtdPedido = document.getElementById('qtd-pedido').value;
            const umPedido = document.getElementById('um-pedido').value;
            const valorLiqPedido = document.getElementById('valor-liq-pedido').value;
            const moeda = document.getElementById('moeda').value;
            const unidPrcPedido = document.getElementById('unid-prc-pedido').value;
            const incompleto = document.getElementById('incompleto').value;
            const tipoDocCompras = document.getElementById('tipo-doc-compras').value;
            const centroFornecedor = document.getElementById('centro-fornecedor').value;
            const textoBreve = document.getElementById('texto-breve').value;

            // Verifique se algum dos campos obrigat√≥rios est√° vazio
            if (!documentoCompras || !fornecedor || !material || !orgCompras || !grpCompradores || !centro) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return; // Pare a execu√ß√£o se algum campo estiver vazio
            }

            // Se todos os campos obrigat√≥rios estiverem preenchidos, continue com o envio do formul√°rio
            const agora = new Date();
            const dia = agora.getDate().toString().padStart(2, '0');
            const mes = (agora.getMonth() + 1).toString().padStart(2, '0');
            const ano = agora.getFullYear();
            const horaAtual = agora.getHours().toString().padStart(2, '0');
            const minutos = agora.getMinutes().toString().padStart(2, '0');
            const segundos = agora.getSeconds().toString().padStart(2, '0');
            const HRpedido = `${dia}/${mes}/${ano} ${horaAtual}:${minutos}:${segundos}`;

            const novoSetup = {
                HRpedido: HRpedido,
                login: login,
                Documento_compras: documentoCompras,
                item: item,
                Fornecedor: fornecedor,
                Grupo_mercadorias: grupoMercadorias,
                Material: material,
                Org_compras: orgCompras,
                Grp_compradores: grpCompradores,
                Centro: centro,
                Deposito: deposito,
                Data_documento: dataDocumento,
                Qtd_pedido: qtdPedido,
                UM_pedido: umPedido,
                Valor_l√≠q_pedido: valorLiqPedido,
                Moeda: moeda,
                Unid_prc_pedido: unidPrcPedido,
                Incompleto: incompleto,
                Tipo_doc_compras: tipoDocCompras,
                Centro_fornecedor: centroFornecedor,
                Texto_breve: textoBreve
            };

            try {
                const response = await fetch(`${BASE_URL}/tabeImpregna`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(novoSetup)
                });

                const data = await response.json();
                console.log('Resposta do servidor:', data);

                showSuccessMessage('4');

                closeForm();
                atualizarDados();
                
            } catch (error) {
                console.error('Erro ao enviar solicita√ß√£o:', error);
            }
        });

//___________________________________________________________________________________

// Dentro do seu script no HTML
            document.getElementById('pedidosContainer').addEventListener('click', function(event) {
                const target = event.target;
                if (target.classList.contains('button-aguardando') || 
                    target.classList.contains('button-atendendo') || 
                    target.classList.contains('button-pronto') || 
                    target.classList.contains('button-esperando') || 
                    target.classList.contains('button-cancelado')) {
                    
                    const status = target.textContent.trim(); // Obt√©m o texto do bot√£o, que ser√° o status
                    const card = target.closest('.card1');

                    if (card) {
                        const infoLineElement = card.querySelector('.info-line');
                        if (infoLineElement) {
                            const id = infoLineElement.textContent.trim(); // Define a vari√°vel id aqui
                            // Fa√ßa o que for necess√°rio com o ID aqui

                            // Fa√ßa uma solicita√ß√£o fetch para atualizar o status do setup
                            fetch(`${BASE_URL}/tabeImpregna/${id}`, {
                                
                                method: 'PUT',
                                
                                headers: {
                                    
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ status: status })
                            })
                            
                            .then(response => {
                                if (response.ok) {
                                    console.log(`Status atualizado para ${status} com sucesso.`);
                                    // Recarregue os dados ap√≥s a atualiza√ß√£o do status
                                    atualizarDados();
                                    showSuccessMessage('2');
                                } else {
                                    console.error('Erro ao atualizar o status.');
                                }
                            })
                            .catch(error => {
                                console.error('Erro ao atualizar o status:', error);
                            });
                        } else {
                            console.error('Elemento com a classe .info-line n√£o encontrado.');
                        }
                    } else {
                        console.error('Elemento com a classe .card n√£o encontrado.');
                    }
                } 
            });
//___________________________________________________________________________________
// Excluir setup com sucesso
//___________________________________________________________________________________
            document.getElementById('pedidosContainer').addEventListener('click', async function(event) {
                const target = event.target;
                if (target.classList.contains('button-excluir')) {
                    const card = target.closest('.card1');

                    if (card) {
                        const infoLineElement = card.querySelector('.info-line');
                        if (infoLineElement) {
                            const id = infoLineElement.textContent.trim(); // Obt√©m o ID do setup

                            try {
                                const response = await fetch(`${BASE_URL}/tabeImpregna/${id}`, {
                                    method: 'DELETE',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ id: id })
                                });

                                if (response.ok) {
                                    atualizarDados();
                                    showSuccessMessage('10');
                                } else {
                                    console.error('Erro ao excluir o setup.');
                                }
                            } catch (error) {
                                console.error('Erro ao excluir o setup:', error);
                            }
                        } else {
                            console.error('Elemento com a classe .info-line n√£o encontrado.');
                        }
                    } else {
                        console.error('Elemento com a classe .card n√£o encontrado.');
                    }
                }
            });

//___________________________________________________________________________________
// Abrir folha de processo
//___________________________________________________________________________________
document.getElementById('pedidosContainer').addEventListener('click', async function(event) {
    const target = event.target;
    if (target.classList.contains('button-fip')) {
        const card = target.closest('.card1');
        if (card) {
            const infoLineElement = card.querySelector('.item');
            if (infoLineElement) {
                const id = infoLineElement.textContent.trim();
                const response = await fetch(`${BASE_URL}/pdf/${id}`);
                const data = await response.json();
                
                // Cria o modal e o conte√∫do da tabela
                const modalContainer = document.createElement('div');
                modalContainer.classList.add('modal1');
                modalContainer.setAttribute('id', 'modalContainer');
                document.body.appendChild(modalContainer);

                let modalContent = `<form id="formNovotabeImpregna">
                                    <table class="excel-like-table modal">
                                        <thead><tr>
                                            <th>Id</th>
                                            <th>Item</th>
                                            <th>Operacao</th>
                                            <th>Dta_Implantacao</th>
                                            <th>FIP_N</th>
                                            <th>Ult_REV</th>
                                            <th>A√ß√£o</th>
                                        </tr></thead>
                                        <tbody>`;
                
                data.forEach(item => {
                    modalContent += `<tr>
                                        <td>${item.Id}</td>
                                        <td>${item.Item}</td>
                                        <td>${item.Operacao}</td>
                                        <td>${new Date(item.Dta_Implantacao).toLocaleDateString()}</td>
                                        <td>${item.FIP_N}</td>
                                        <td>${new Date(item.Ult_REV).toLocaleDateString()}</td>
                                        <td><button class="button-open" data-fip-n="${item.FIP_N}">Abrir</button></td>
                                    </tr>`;
                });

                modalContent += `</tbody></table></form>`;
                modalContainer.innerHTML = modalContent;
                modalContainer.style.display = "block";

                modalContainer.querySelector('.close-button').onclick = function() {
                    modalContainer.style.display = "none";
                    document.body.removeChild(modalContainer);
                };
            }
        }
    }
});

document.addEventListener('click', function(event) {
    if (event.target.classList.contains('button-open')) {
        const fipN = event.target.getAttribute('data-fip-n');
        const pdfUrl = `${BASE_URL}/pdfabrir/${fipN}`;
        console.log(`Abrindo PDF na URL: ${pdfUrl}`);
        window.open(pdfUrl, '_blank');
    }
});

//___________________________________________________________________________________
// Adicione um evento de clique para cada bot√£o de status
//___________________________________________________________________________________                        
            function openForm() {
                document.getElementById("overlay").style.display = "block";
            }

            function closeForm() {
                document.getElementById("overlay").style.display = "none";
            }
//___________________________________________________________________________________
// Chame a fun√ß√£o de atualiza√ß√£o quando a p√°gina carregar
//___________________________________________________________________________________
            window.addEventListener('load', function() {
                atualizarDados();
                console.log("teste")
                showSuccessMessage('1');
                // Atualize os dados a cada 5 minutos
                setInterval(atualizarDados, 1 * 60 * 10000); // 5 minutos * 60 segundos * 1000 milissegundos
            });
 //___________________________________________________________________________________
// Adicione um evento de escuta ao elemento <select> de centro de custo
//___________________________________________________________________________________
document.getElementById('centro-custo').addEventListener('change', function() {
    // Recupere o valor do centro de custo selecionado
    const centroCustoSelecionado = this.value;

    // Fa√ßa uma solicita√ß√£o fetch para obter as m√°quinas correspondentes ao centro de custo selecionado
    fetch(`${BASE_URL}/maquinas?centroCusto=${centroCustoSelecionado}`)
        .then(response => response.json())
        .then(data => {
            // Limpe as op√ß√µes atuais do <select> de m√°quinas
            const selectMaquina = document.getElementById('maquina');
            selectMaquina.innerHTML = '';

            // Preencha o <select> de m√°quinas com as op√ß√µes obtidas
            data.forEach(maquina => {
                const option = document.createElement('option');
                option.value = maquina.Maquina; // Defina o valor da op√ß√£o como o nome da m√°quina
                option.textContent = maquina.Maquina; // Defina o texto vis√≠vel da op√ß√£o como o nome da m√°quina
                selectMaquina.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Erro ao carregar m√°quinas:', error);
        });
});

    </script>

    <link rel="stylesheet" href="/css/public.css">
    <link rel="stylesheet" href="/css/SSU.css">
    <script src="/js/SSU.js"></script>
    <script src="/js/public.js"></script>

</body>
</html>